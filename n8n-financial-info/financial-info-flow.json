{
  "name": "Financial Info - BR & US Stocks",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Para n8n - Code Node\nconst items = $input.all();\n\nconst brazilStocks = [];\nconst usStocks = [];\n\n// Iterar sobre todos os itens\nfor (const item of items) {\n  const brStock = item.json['A√ß√£o BR'];\n  const usStock = item.json['A√ß√£o US'];\n  \n  // Adicionar a√ß√£o brasileira se n√£o estiver vazia\n  if (brStock && brStock.trim() !== '') {\n    brazilStocks.push(brStock.trim());\n  }\n  \n  // Adicionar a√ß√£o americana se n√£o estiver vazia\n  if (usStock && usStock.trim() !== '') {\n    usStocks.push(usStock.trim());\n  }\n}\n\n// Gerar data/hora atual em formato brasileiro\nconst now = new Date();\nconst brazilTime = now.toLocaleString('pt-BR', { \n  timeZone: 'America/Sao_Paulo',\n  dateStyle: 'short',\n  timeStyle: 'short'\n});\n\n// Retornar no formato desejado\nreturn [{\n  json: {\n    stocks: {\n      br: brazilStocks,\n      us: usStocks\n    },\n    data_geracao: brazilTime,\n    total_brazil: brazilStocks.length,\n    total_us: usStocks.length,\n    total: brazilStocks.length + usStocks.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        0
      ],
      "id": "824a4757-3e35-4e44-8ba5-f7541177ffd1",
      "name": "SplitStocksByMarket"
    },
    {
      "parameters": {
        "sendTo": "ldias.rs@gmail.com",
        "subject": "=Financial info {{ DateTime.now() }}",
        "message": "={{ $json.content.parts[0].text }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1408,
        0
      ],
      "id": "647a87a1-5bba-4aea-af87-62dedb7ae948",
      "name": "Send a message1",
      "webhookId": "1e9843d7-2eba-4798-a79b-72df46b1fcd8",
      "credentials": {
        "gmailOAuth2": {
          "id": "Mx40O4DWSK5YGsKn",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "months",
              "triggerAtHour": 12
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "9dd3a356-d690-42c2-a87f-360dc2ff8750",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.prompt }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        880,
        0
      ],
      "id": "887294ee-cfa8-4427-8832-03d607dc1b84",
      "name": "Financial Stock Info1",
      "credentials": {
        "googlePalmApi": {
          "id": "xg8JJT12sq4nKGDw",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1Gav5wJnn-w-SffIATp_OVKfDdiIbE3AIPqxvZD8_zTI",
          "mode": "list",
          "cachedResultName": "Stock-info",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Gav5wJnn-w-SffIATp_OVKfDdiIbE3AIPqxvZD8_zTI/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "1",
          "mode": "name"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        0
      ],
      "id": "7e5c71af-a545-40d7-8f34-6cc0e4732226",
      "name": "GetStockRows1",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "TcsAIidzUoiqPfyA",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Load the prompt from the markdown file\n// In n8n, you would typically store this in a Set node or read from a file\n// For now, we'll include the updated prompt directly\n\nconst basePrompt = `# Prompt: Relat√≥rio de A√ß√µes Brasileiras e Americanas\n\n## üéØ INSTRU√á√ÉO PRINCIPAL\n\n**VOC√ä DEVE GERAR UM RELAT√ìRIO HTML COMPLETO E PRONTO PARA USO COM DADOS REAIS E ATUALIZADOS.**\n\n**PROIBIDO:**\n- ‚ùå Usar placeholders, vari√°veis ou templates (ex: {{VALOR}}, {PERCENTUAL}, etc.)\n- ‚ùå Deixar campos vazios ou com \"dados a serem preenchidos\"\n- ‚ùå Gerar c√≥digo JavaScript para preencher dados posteriormente\n- ‚ùå Usar dados fict√≠cios ou simulados sem avisar explicitamente\n\n**OBRIGAT√ìRIO:**\n- ‚úÖ Buscar cota√ß√µes REAIS e ATUALIZADAS de todas as a√ß√µes\n- ‚úÖ Preencher TODOS os valores com dados reais do mercado\n- ‚úÖ Usar data e hora ATUAL do momento da gera√ß√£o\n- ‚úÖ Retornar HTML 100% completo e funcional\n\n---\n\n## üìã Objetivo\nGerar um relat√≥rio completo e atualizado sobre a√ß√µes da **bolsa brasileira (B3)** e **bolsas americanas (NYSE/NASDAQ)**, formatado em HTML para envio por e-mail, com informa√ß√µes relevantes para tomada de decis√£o de investimento.\n\n---\n\n## üìä Estrutura do Relat√≥rio\n\n### Organiza√ß√£o Geral:\n\nO relat√≥rio deve ter **DUAS SE√á√ïES PRINCIPAIS** claramente separadas:\n\n1. **üáßüá∑ A√á√ïES BRASILEIRAS (B3)** - Todas as a√ß√µes do Brasil\n2. **üá∫üá∏ A√á√ïES AMERICANAS (NYSE/NASDAQ)** - Todas as a√ß√µes dos EUA\n\nCada se√ß√£o deve ter seu pr√≥prio:\n- Resumo executivo espec√≠fico (quantas subiram/ca√≠ram, maior alta, maior baixa)\n- Lista de a√ß√µes com an√°lise completa\n- Cota√ß√µes na moeda correspondente (R$ para BR, US$ para US)\n\n---\n\n### Para cada a√ß√£o, inclua:\n\n#### 1. Cabe√ßalho da A√ß√£o\n- C√≥digo e nome completo da empresa\n- Setor de atua√ß√£o\n\n#### 2. üìà Cota√ß√µes e Performance\n- Cota√ß√£o Atual (com data/hora)\n- Varia√ß√£o no Dia\n- √öltimo M√™s (30d)\n- √öltimo Ano (12m)\n- √öltimos 3 Anos\n\n#### 3. üìä Indicadores Fundamentalistas\n- P/L, Dividend Yield, P/VP, ROE\n\n#### 4. üí∞ Proventos\n- Listar proventos declarados e previstos\n\n#### 5. üì∞ Not√≠cias Relevantes\n- 3-5 not√≠cias mais relevantes dos √∫ltimos 30 dias\n\n#### 6. üéØ An√°lise T√©cnica\n- Suportes, Resist√™ncias, M√©dias M√≥veis\n\n---\n\n## ‚ö†Ô∏è REGRAS CR√çTICAS\n\n### üö´ NUNCA:\n- Use placeholders como {{VARIAVEL}}\n- Deixe dados faltando\n- Gere JavaScript para preencher depois\n\n### ‚úÖ SEMPRE:\n- Busque dados REAIS\n- Preencha TODOS os valores\n- Use data/hora ATUAL\n- Forne√ßa HTML completo\n\n---\n\n## üî¥ LEMBRETE FINAL\n\n**SE VOC√ä GERAR PLACEHOLDERS OU VARI√ÅVEIS N√ÉO PREENCHIDAS, A TAREFA SER√Å CONSIDERADA FALHADA.**\n\nRetorne APENAS HTML completo, funcional e com todos os dados preenchidos.\n\n\n### üîå APIs e Fontes de Dados Recomendadas:\n\n#### APIs Gratuitas para A√ß√µes Brasileiras (B3):\n1. **Brapi** (https://brapi.dev)\n   - API gratuita com cota√ß√µes B3 em tempo real\n   - Endpoint: \"https://brapi.dev/api/quote/{ticker}\"\n   - Exemplo: \"https://brapi.dev/api/quote/ITSA4\"\n\n2. **Yahoo Finance API**\n   - Use o sufixo \".SA\" para a√ß√µes brasileiras\n   - Exemplo: \"ITSA4.SA\", \"ITUB4.SA\"\n\n3. **HG Brasil Finance API**\n   - API brasileira com dados do mercado\n   - Cota√ß√µes, moedas e muito mais\n\n#### APIs Gratuitas para A√ß√µes Americanas (US):\n1. **Yahoo Finance API**\n   - Sem sufixo para a√ß√µes americanas\n   - Exemplo: \"AAPL\", \"GOOGL\", \"MSFT\"\n\n2. **Alpha Vantage** (https://www.alphavantage.co)\n   - API gratuita (limite de requests)\n   - Endpoint: \"https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol={ticker}\"\n\n3. **Finnhub** (https://finnhub.io)\n   - API gratuita com cota√ß√µes em tempo real\n   - Boa cobertura de a√ß√µes americanas\n\n#### Sites para Web Scraping (se necess√°rio):\n**Brasil:**\n- Status Invest (https://statusinvest.com.br)\n- Fundamentus (https://www.fundamentus.com.br)\n- InfoMoney (https://www.infomoney.com.br)\n- Investing.com Brasil (https://br.investing.com)\n\n**EUA:**\n- Yahoo Finance (https://finance.yahoo.com)\n- MarketWatch (https://www.marketwatch.com)\n- Seeking Alpha (https://seekingalpha.com)\n- Investing.com (https://www.investing.com)\n\n#### Para Not√≠cias:\n**Brasil:**\n- InfoMoney not√≠cias\n- Valor Econ√¥mico\n- B3 - Comunicados e Fatos Relevantes\n\n**EUA:**\n- Bloomberg\n- CNBC\n- Reuters\n- Yahoo Finance News\n- MarketWatch\n\n## üîî Alertas Importantes\n\nInclua alertas quando aplic√°vel:\n- ‚ö†Ô∏è Varia√ß√£o superior a ¬±5% no dia\n- üì¢ Resultados trimestrais divulgados recentemente\n- üíµ Proventos com data de pagamento pr√≥xima (pr√≥ximos 7 dias)\n- üî• Not√≠cias de alto impacto (fus√µes, aquisi√ß√µes, mudan√ßas estrat√©gicas)\n\n\n## üî¥ LEMBRETE FINAL - LEIA NOVAMENTE\n\n### ESTE PROMPT EXIGE:\n\n1. **HTML COMPLETO** - Pronto para abrir no navegador e enviar por e-mail\n2. **DADOS REAIS** - Busque cota√ß√µes, not√≠cias e indicadores atualizados\n3. **ZERO PLACEHOLDERS** - Nenhum \"{{VARIAVEL}}\", \"{VALOR}\" ou similar\n4. **SEM JAVASCRIPT** - N√£o gere scripts para preencher dados depois\n5. **DATA ATUAL** - Use a data e hora real do momento da gera√ß√£o\n\n### SE VOC√ä GERAR PLACEHOLDERS OU VARI√ÅVEIS N√ÉO PREENCHIDAS, A TAREFA SER√Å CONSIDERADA FALHADA.\n\n`;\n\nconst stocks = $input.item.json.stocks\nconst stocksBr = JSON.stringify(stocks.br)\nconst stocksUs = JSON.stringify(stocks.us)\n\nconst prompt = `Use this stock list to generate the report:\\n\\n\" US: ${stocksUs} BR: ${stocksBr} \n\n${basePrompt}\n\\n\\n\n\n`\n\nreturn [{\n  json: {\n    prompt: prompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        0
      ],
      "id": "997fa3e2-4d51-4de1-b2fa-770c0d65612c",
      "name": "Prompt"
    }
  ],
  "pinData": {},
  "connections": {
    "SplitStocksByMarket": {
      "main": [
        [
          {
            "node": "Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "GetStockRows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Financial Stock Info1": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetStockRows1": {
      "main": [
        [
          {
            "node": "SplitStocksByMarket",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prompt": {
      "main": [
        [
          {
            "node": "Financial Stock Info1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "HOB5DNjfjjnwHLUg",
    "executionTimeout": 3600,
    "timeSavedPerExecution": 30
  },
  "versionId": "65395059-f357-438f-8bfd-d12a870b6e06",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c4d6a8d4fd80a8d9138c380c50a14cd195951e4a2b31f687a6d6dc7a33dd0c5c"
  },
  "id": "HOB5DNjfjjnwHLUg",
  "tags": []
}